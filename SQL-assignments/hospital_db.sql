CREATE DATABASE HOSPITAL_DB
USE HOSPITAL_DB

-- COMMAND TO SHOW LIST OF TABLES 
SELECT NAME,CREATE_DATE, MODIFY_DATE 
FROM SYS.TABLES

CREATE TABLE PATIENTS (
    PATIENTID INT,
    PATIENTNAME VARCHAR(100),
    AADHAAR VARCHAR(12),
    GENDER VARCHAR(10),
    DOB DATE,
    PHONE VARCHAR(15),
    ADDRESS VARCHAR(255)
);

ALTER TABLE PATIENTS 
ALTER COLUMN PATIENTID INT NOT NULL 

ALTER TABLE PATIENTS
ADD CONSTRAINT PK_PATIENT PRIMARY KEY (PATIENTID)

ALTER TABLE PATIENTS 
ADD CONSTRAINT UQ_PATIENTS UNIQUE (AADHAAR)

ALTER TABLE PATIENTS
ADD CONSTRAINT CK_PATIENTS CHECK(GENDER IN ('M', 'F'))

ALTER TABLE PATIENTS 
DROP CONSTRAINT CK_PATIENTS

ALTER TABLE PATIENTS
ALTER COLUMN DOB DATE NOT NULL

CREATE TABLE DOCTORS (
    DOCTORID INT,
    DOCTORNAME VARCHAR(100),
    EMAIL VARCHAR(100),
    DEPARTMENTID INT,
    EXPERIENCE INT
);

ALTER TABLE DOCTORS 
ALTER COLUMN DOCTORID INT NOT NULL 

ALTER TABLE DOCTORS
ADD CONSTRAINT DK_DOCTORS PRIMARY KEY (DOCTORID)


CREATE TABLE DEPARTMENTS (
    DEPARTMENTID INT,
    DEPARTMENTNAME VARCHAR(100)
);

ALTER TABLE DEPARTMENTS 
ALTER COLUMN DEPARTMENTID INT NOT NULL 

ALTER TABLE DEPARTMENTS
ADD CONSTRAINT DEPARTMENTID PRIMARY KEY (DEPARTMENTID)

ALTER TABLE DEPARTMENTS
ADD CONSTRAINT UQ_DEPARTMENTNAME UNIQUE (DEPARTMENTNAME)

ALTER TABLE DOCTORS
ADD CONSTRAINT FK_DEPARTMENTID FOREIGN KEY (DEPARTMENTID)
REFERENCES DEPARTMENTS(DEPARTMENTID)


CREATE TABLE ROOMS (
    ROOMID INT,
    ROOMTYPE VARCHAR(20),
    CHARGESPERDAY DECIMAL(10,2)
);


ALTER TABLE ROOMS 
ALTER COLUMN ROOMID INT NOT NULL 

ALTER TABLE ROOMS
ADD CONSTRAINT PK_ROOMID PRIMARY KEY (ROOMID)

ALTER TABLE ROOMS
ADD CONSTRAINT CK_ROOMS CHECK(ROOMTYPE IN ('GENERAL','ICU','PRIVATE'))

ALTER TABLE ROOMS 
ADD CONSTRAINT CK_ROOMCHARGE CHECK(CHARGESPERDAY > 0)


--APPOINTMENTS: 
--• APPOINTMENTID → PRIMARY KEY 
--• PATIENTID → FOREIGN KEY 
--• DOCTORID → FOREIGN KEY 
--• APPOINTMENTDATE → DEFAULT GETDATE()

CREATE TABLE APPOINTMENTS (
    APPOINTMENTID INT,
    PATIENTID INT,
    DOCTORID INT,
    APPOINTMENTDATE DATETIME
);

ALTER TABLE APPOINTMENTS
ALTER COLUMN APPOINTMENTID INT NOT NULL

ALTER TABLE APPOINTMENTS
ADD CONSTRAINT PK_APPOINTMENTID PRIMARY KEY (APPOINTMENTID)

ALTER TABLE APPOINTMENTS 
ADD CONSTRAINT FK_PATIENTID FOREIGN KEY (PATIENTID)
REFERENCES PATIENTS (PATIENTID)

ALTER TABLE APPOINTMENTS 
ADD CONSTRAINT FK_DOCTORID FOREIGN KEY (DOCTORID)
REFERENCES DOCTORS (DOCTORID)

ALTER TABLE APPOINTMENTS
ADD CONSTRAINT DF_APDATE 
DEFAULT GETDATE() FOR APPOINTMENTDATE

------------------- SYNTAX FOR DEFUALT CONSTRAINT
--ALTER TABLE PERSONS
--ADD CONSTRAINT DF_CITY
--DEFAULT 'SANDNES' FOR CITY;



CREATE TABLE ADMISSIONS (
    ADMISSIONID INT,
    PATIENTID INT,
    ROOMID INT,
    ADMITDATE DATETIME,
    DISCHARGEDATE DATETIME
);

--ADMISSIONS: 
--• ADMISSIONID → PRIMARY KEY 
--• PATIENTID → FOREIGN KEY 
--• ROOMID → FOREIGN KEY 
--• ADMITDATE → DEFAULT GETDATE() 
--• DISCHARGEDATE → NULLABLE

ALTER TABLE ADMISSIONS 
ALTER COLUMN ADMISSIONID INT NOT NULL

ALTER TABLE ADMISSIONS
ADD CONSTRAINT PK_ADMISSIONID PRIMARY KEY (ADMISSIONID)

ALTER TABLE ADMISSIONS 
ADD CONSTRAINT FK_ADMIPATIENTID FOREIGN KEY (PATIENTID)
REFERENCES PATIENTS (PATIENTID)

ALTER TABLE ADMISSIONS 
ADD CONSTRAINT FK_ADMIROOMID FOREIGN KEY (ROOMID)
REFERENCES ROOMS (ROOMID)

CREATE TABLE TREATMENTS (
    TREATMENTID INT,
    ADMISSIONID INT,
    TREATMENTDESCRIPTION VARCHAR(255),
    TREATMENTCOST DECIMAL(10,2)
);

SP_HELP 'TREATMENTS'

--TREATMENTS: 
--• TREATMENTID → PRIMARY KEY 
--• ADMISSIONID → FOREIGN KEY 
--• TREATMENTCOST → CHECK (>0)


ALTER TABLE TREATMENTS 
ALTER COLUMN TREATMENTID INT NOT NULL

ALTER TABLE TREATMENTS
ADD CONSTRAINT PK_TREATMENTID PRIMARY KEY (TREATMENTID)

ALTER TABLE TREATMENTS 
ADD CONSTRAINT FK_ADMISSIONID FOREIGN KEY (ADMISSIONID)
REFERENCES ADMISSIONS (ADMISSIONID)

ALTER TABLE TREATMENTS
ADD CONSTRAINT CK_TREATMENTS CHECK(TREATMENTCOST > 0)


CREATE TABLE BILLS (
    BILLID INT,
    ADMISSIONID INT,
    TOTALAMOUNT DECIMAL(10,2)
);

ALTER TABLE BILLS 
ALTER COLUMN BILLID INT NOT NULL

ALTER TABLE BILLS
ADD CONSTRAINT PK_BILLID PRIMARY KEY (BILLID)

ALTER TABLE BILLS 
ADD CONSTRAINT FK_BILL_ADMISSIONID FOREIGN KEY (ADMISSIONID)
REFERENCES ADMISSIONS (ADMISSIONID)


--BILLS: 
--• BILLID → PRIMARY KEY 
--• ADMISSIONID → FOREIGN KEY 
--• TOTALAMOUNT → CHECK (>0) 



CREATE TABLE PAYMENTS (
    PAYMENTID INT,
    BILLID INT,
    PAYMENTMODE VARCHAR(20),
    PAIDAMOUNT DECIMAL(10,2),
    PAYMENTDATE DATETIME
);

ALTER TABLE PAYMENTS 
ALTER COLUMN  PAYMENTID INT NOT NULL

ALTER TABLE PAYMENTS
ADD CONSTRAINT PK_PAYMENTID PRIMARY KEY (PAYMENTID)

ALTER TABLE PAYMENTS 
ADD CONSTRAINT FK_BILLID FOREIGN KEY (BILLID)
REFERENCES BILLS (BILLID)


--PAYMENTS: 
--• PAYMENTID → PRIMARY KEY 
--• BILLID → FOREIGN KEY 
--• PAYMENTMODE → CHECK ('CASH','CARD','UPI') 
--• PAIDAMOUNT → CHECK (>0)

INSERT INTO DEPARTMENTS VALUES
(1,'CARDIOLOGY'),
(2,'NEUROLOGY'),
(3,'ORTHOPEDICS'),
(4,'PEDIATRICS'),
(5,'GENERAL MEDICINE');

INSERT INTO DOCTORS VALUES
(1,'AMIT','SHAH',1,10),
(2,'RIYA','MEHTA',2,7),
(3,'KARAN','PATEL',3,4),
(4,'SNEHA','IYER',4,6),
(5,'RAJ','VERMA',5,8),
(6,'NITA','DESAI',1,3),
(7,'ARJUN','KAPOOR',2,12),
(8,'PRIYA','NAIR',3,5);


INSERT INTO PATIENTS VALUES
(1,'RAHUL','JOSHI','M','2001-05-12','9876543210','AHMEDABAD'),
(2,'NEHA','SHARMA','F','1998-07-21','9876543211','MUMBAI'),
(3,'VIKAS','RAO','M','2003-02-15','9876543212','DELHI'),
(4,'ANJALI','SINGH','F','1995-09-10','9876543213','PUNE'),
(5,'ROHAN','KAPOOR','M','2002-11-01','9876543214','JAIPUR'),
(6,'MEERA','PATEL','F','1999-01-19','9876543215','AHMEDABAD'),
(7,'KUNAL','SHAH','M','2004-06-25','9876543216','SURAT'),
(8,'DIVYA','NAIR','F','1997-03-18','9876543217','CHENNAI'),
(9,'MANISH','YADAV','M','1996-12-05','9876543218','LUCKNOW'),
(10,'POOJA','REDDY','F','2000-08-14','9876543219','HYDERABAD'),
(11,'AKASH','TRIVEDI','M','2005-04-09','9876543220','AHMEDABAD'),
(12,'SIMRAN','GILL','F','2001-10-30','9876543221','DELHI'),
(13,'NIKHIL','MALHOTRA','M','1994-07-12','9876543222','CHANDIGARH'),
(14,'AARTI','KULKARNI','F','2003-09-22','9876543223','PUNE'),
(15,'SAHIL','ARORA','M','2002-01-11','9876543224','MUMBAI'),
(16,'ISHA','BANSAL','F','1999-02-17','9876543225','JAIPUR'),
(17,'RITESH','GUPTA','M','1998-05-05','9876543226','INDORE'),
(18,'TANVI','DESAI','F','2004-12-19','9876543227','AHMEDABAD'),
(19,'YASH','PANDEY','M','1997-11-23','9876543228','VARANASI'),
(20,'KRITI','SINHA','F','2001-06-07','9876543229','PATNA');

INSERT INTO ROOMS VALUES
(1,'ICU',5000),
(2,'ICU',5500),
(3,'GENERAL',2000),
(4,'GENERAL',1800),
(5,'PRIVATE',4000),
(6,'PRIVATE',4200),
(7,'ICU',6000),
(8,'GENERAL',2100),
(9,'PRIVATE',3900),
(10,'GENERAL',2200),
(11,'ICU',5800),
(12,'PRIVATE',4500),
(13,'GENERAL',1900),
(14,'ICU',6200),
(15,'PRIVATE',4100);

INSERT INTO APPOINTMENTS VALUES
(1,1,1,'2026-01-01'),
(2,2,2,'2026-01-02'),
(3,3,3,'2026-01-03'),
(4,4,4,'2026-01-04'),
(5,5,5,'2026-01-05'),
(6,6,6,'2026-01-06'),
(7,7,7,'2026-01-07'),
(8,8,8,'2026-01-08'),
(9,9,1,'2026-01-09'),
(10,10,2,'2026-01-10'),
(11,11,3,'2026-01-11'),
(12,12,4,'2026-01-12'),
(13,13,5,'2026-01-13'),
(14,14,6,'2026-01-14'),
(15,15,7,'2026-01-15'),
(16,16,8,'2026-01-16'),
(17,17,1,'2026-01-17'),
(18,18,2,'2026-01-18'),
(19,19,3,'2026-01-19'),
(20,20,4,'2026-01-20'),
(21,1,5,'2026-01-21'),
(22,2,6,'2026-01-22'),
(23,3,7,'2026-01-23'),
(24,4,8,'2026-01-24'),
(25,5,1,'2026-01-25'),
(26,6,2,'2026-01-26'),
(27,7,3,'2026-01-27'),
(28,8,4,'2026-01-28'),
(29,9,5,'2026-01-29'),
(30,10,6,'2026-01-30');

INSERT INTO ADMISSIONS VALUES
(1,1,1,'2026-01-01','2026-01-05'),
(2,2,3,'2026-01-02','2026-01-06'),
(3,3,5,'2026-01-03','2026-01-08'),
(4,4,7,'2026-01-04','2026-01-09'),
(5,5,9,'2026-01-05','2026-01-10'),
(6,6,2,'2026-01-06',NULL),
(7,7,4,'2026-01-07','2026-01-12'),
(8,8,6,'2026-01-08','2026-01-13'),
(9,9,8,'2026-01-09',NULL),
(10,10,10,'2026-01-10','2026-01-15'),
(11,11,11,'2026-01-11','2026-01-16'),
(12,12,12,'2026-01-12','2026-01-17'),
(13,13,13,'2026-01-13','2026-01-18'),
(14,14,14,'2026-01-14',NULL),
(15,15,15,'2026-01-15','2026-01-20');

INSERT INTO TREATMENTS VALUES
(1,1,'HEART SURGERY',85000.00),
(2,2,'BRAIN MRI SCAN',15000.00),
(3,3,'FRACTURE FIXATION',40000.00),
(4,4,'CHILD VACCINATION',5000.00),
(5,5,'FEVER TREATMENT',3000.00),
(6,6,'CARDIAC MONITORING',20000.00),
(7,7,'NEURO THERAPY',25000.00),
(8,8,'KNEE REPLACEMENT',90000.00),
(9,9,'PEDIATRIC CHECKUP',4000.00),
(10,10,'DIABETES MANAGEMENT',10000.00),
(11,11,'ANGIOGRAPHY',60000.00),
(12,12,'MIGRAINE TREATMENT',8000.00),
(13,13,'BACK PAIN THERAPY',12000.00),
(14,14,'ICU OBSERVATION',30000.00),
(15,15,'GENERAL CONSULTATION',2000.00),
(16,1,'ECG TEST',3500.00),
(17,2,'CT SCAN',18000.00),
(18,3,'BONE PLASTER',7000.00),
(19,4,'IMMUNIZATION',4500.00),
(20,5,'BLOOD TEST',1500.00),
(21,6,'STRESS TEST',9000.00),
(22,7,'SPINE THERAPY',22000.00),
(23,8,'PHYSIOTHERAPY',6000.00),
(24,9,'NEBULIZATION',2500.00),
(25,10,'INSULIN THERAPY',11000.00);

INSERT INTO BILLS VALUES
(1,1,75000),
(2,2,45000),
(3,3,90000),
(4,4,30000),
(5,5,60000),
(6,6,20000),
(7,7,55000),
(8,8,40000),
(9,9,80000),
(10,10,35000),
(11,11,72000),
(12,12,48000),
(13,13,65000),
(14,14,52000),
(15,15,30000);

INSERT INTO PAYMENTS 
(PAYMENTID, BILLID, PAYMENTMODE, PAIDAMOUNT, PAYMENTDATE)
VALUES
(1,1,'CASH',50000.00,'2026-01-06 10:00:00'),
(2,1,'UPI',25000.00,'2026-01-07 11:00:00'),
(3,2,'CARD',45000.00,'2026-01-08 09:30:00'),
(4,3,'CASH',50000.00,'2026-01-09 12:00:00'),
(5,3,'CARD',40000.00,'2026-01-10 14:00:00'),
(6,4,'UPI',30000.00,'2026-01-11 10:15:00'),
(7,5,'CASH',60000.00,'2026-01-12 16:00:00'),
(8,6,'CARD',20000.00,'2026-01-13 13:30:00'),
(9,7,'UPI',55000.00,'2026-01-14 11:45:00'),
(10,8,'CASH',40000.00,'2026-01-15 10:20:00'),
(11,9,'CARD',80000.00,'2026-01-16 09:10:00'),
(12,10,'UPI',35000.00,'2026-01-17 15:00:00'),
(13,11,'CASH',72000.00,'2026-01-18 14:30:00'),
(14,12,'CARD',48000.00,'2026-01-19 12:40:00'),
(15,13,'UPI',65000.00,'2026-01-20 11:25:00'),
(16,14,'CASH',30000.00,'2026-01-21 10:10:00'),
(17,14,'CARD',22000.00,'2026-01-22 09:55:00'),
(18,15,'UPI',30000.00,'2026-01-23 16:20:00'),
(19,5,'CASH',10000.00,'2026-01-24 13:00:00'),
(20,7,'CARD',5000.00,'2026-01-25 15:35:00');

--SECTION 4 — BASIC QUERIES (DQL) 
--1. DISPLAY ALL PATIENTS. 
SELECT * FROM PATIENTS

--2. SHOW PATIENTS BORN AFTER THE YEAR 2000. 
SELECT * FROM PATIENTS WHERE DOB > '2000-12-31'

--3. DISPLAY ALL ICU ROOMS. 
SELECT * FROM ROOMS WHERE ROOMTYPE = 'ICU'

--4. SHOW DOCTORS WITH MORE THAN 5 YEARS OF EXPERIENCE. 
SELECT * FROM DOCTORS WHERE EXPERIENCE > 5

--5. COUNT TOTAL NUMBER OF PATIENTS. 
SELECT COUNT(*) FROM PATIENTS


--SECTION 5 — GROUP BY / HAVING 
--1. DEPARTMENT-WISE DOCTOR COUNT. 
SELECT COUNT(*) FROM DOCTORS 
GROUP BY DEPARTMENTID

--2. ROOM TYPE-WISE ADMISSION COUNT. 
SELECT COUNT(*) FROM ADMISSIONS
GROUP BY ROOMID

--3. PATIENT-WISE TOTAL BILL AMOUNT GREATER THAN 50,000. 
SELECT A.PATIENTID,
       SUM(B.TOTALAMOUNT) AS TOTALBILLAMOUNT
FROM BILLS B
JOIN ADMISSIONS A ON B.ADMISSIONID = A.ADMISSIONID
GROUP BY A.PATIENTID
HAVING SUM(B.TOTALAMOUNT) > 50000

--4. DOCTOR-WISE APPOINTMENT COUNT.
SELECT DOCTORID,
       COUNT(*) AS APPOINTMENTCOUNT
FROM APPOINTMENTS
GROUP BY DOCTORID



--SECTION 6 — SUBQUERIES 
--1. FIND THE PATIENT WITH THE HIGHEST BILL AMOUNT.
SELECT A.PATIENTID
FROM BILLS B
JOIN ADMISSIONS A ON B.ADMISSIONID = A.ADMISSIONID
WHERE B.TOTALAMOUNT = (
        SELECT MAX(TOTALAMOUNT)
        FROM BILLS
);
--2. FIND THE DOCTOR WHO HANDLED THE MAXIMUM PATIENTS. 
   SELECT D.DOCTORID,
       COUNT(A.PATIENTID) AS TOTALPATIENTS
FROM DOCTORS D
JOIN APPOINTMENTS A ON D.DOCTORID = A.DOCTORID
GROUP BY D.DOCTORID
HAVING COUNT(A.PATIENTID) = (
        SELECT MAX(PATIENTCOUNT)
        FROM (
            SELECT COUNT(PATIENTID) AS PATIENTCOUNT
            FROM APPOINTMENTS
            GROUP BY DOCTORID
        ) AS TEMP
)

--3. FIND PATIENTS WHO WERE NEVER ADMITTED.
    SELECT P.*
    FROM Patients P
    LEFT JOIN Admissions A 
           ON P.PatientID = A.PatientID
    WHERE A.PatientID IS NULL;

--4. FIND ROOMS THAT WERE NEVER USED. 
    SELECT R.*
    FROM Rooms R
    LEFT JOIN Admissions A
           ON R.RoomID = A.RoomID
    WHERE A.RoomID IS NULL;


--SECTION 7 — UPDATE / DELETE 
--1. INCREASE ALL ROOM CHARGES BY 10%. 
    UPDATE Rooms
    SET CHARGESPERDAY = CHARGESPERDAY * 1.10;
    SELECT * FROM ROOMS

--2. CHANGE A DOCTOR’S DEPARTMENT. 
UPDATE Doctors
SET DepartmentID = 2
WHERE DoctorID = 3;

--3. DELETE A PATIENT SAFELY (HANDLE FOREIGN KEY ISSUES). 
DELETE P
FROM Payments P
JOIN Bills B ON P.BillID = B.BillID
JOIN Admissions A ON B.AdmissionID = A.AdmissionID
WHERE A.PatientID = 5

DELETE B
FROM Bills B
JOIN Admissions A ON B.AdmissionID = A.AdmissionID
WHERE A.PatientID = 5

DELETE T
FROM Treatments T
JOIN Admissions A ON T.AdmissionID = A.AdmissionID
WHERE A.PatientID = 5

DELETE FROM Admissions
WHERE PatientID = 5

DELETE FROM Appointments
WHERE PatientID = 5

DELETE FROM Patients
WHERE PatientID = 5


--4. UPDATE DISCHARGE DATE FOR ADMITTED PATIENTS. 
UPDATE Admissions
SET DischargeDate = GETDATE()
WHERE DischargeDate IS NULL


--SECTION 8 — ALTER TABLE 
--1. ADD A COLUMN BLOODGROUP IN PATIENTS. 
ALTER TABLE Patients
ADD BloodGroup VARCHAR(5)
select * from Patients


--2. ADD A COLUMN QUALIFICATION IN DOCTOR
ALTER TABLE Doctors
ADD Qualification VARCHAR(100)

--3. MODIFY DATATYPE OF A COLUMN. 
ALTER TABLE Patients
ALTER COLUMN Phone BIGINT


--4. DROP A COLUMN FROM ANY TABLE.
ALTER TABLE Doctors
DROP COLUMN Qualification